<!DOCTYPE html>
<html lang="en">

<head>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link type="text/css" rel="stylesheet" href="css/flexboxgrid.css">
    <link type="text/css" rel="stylesheet" href="css/main.css">
    <script src="https://code.jquery.com/jquery-3.2.1.min.js" type="text/javascript" charset="utf-8"></script>
    <meta charset="UTF-8">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/0.16.2/axios.min.js"></script>
    <title>Shit I didn't Invest</title>
</head>

<body>
    <div class="container">
        <section id="header">
            <div class="row end-md center-xs">
            <div class="col-md-3 col-xs-12 col-sm-12" style="float:left">
                 How much would you have made today?
                </div>
            <div class="col-md-9 col-xs-12 col-sm-12" style="float:right">
                    About
                </div>
            </div>
        </section>
        <section id="main" class="actual">
            <div class="row center-xs  query">
                <div class="col-md-12 col-xs-12">
                    If you invested $<span id="amount"></span> in Bitcoin on <span id="date"></span>.
                </div>
                <div class="col-md-12 col-xs-12">
                    You would have made <span id="percentage"></span>% ROI and $<span id="profit"></span> in profits.
                </div>
            </div>

        </section>
                </div>
        <section id="share">
        <div class="row center-xs ">
            <div class="col-md-12">
                <div class="share">

            </div>
        </div>
        </div>
        </section>



</body>

</html>
<style>
body {
    background: #005397;
}

.share {


    height: 300px;
    font-family: 'Roboto', sans-serif;
    color: black;
    font-size: 2.67rem;
    font-weight: 100;
}
.vcv {
     margin-top: 100px;
    background: #B7E3E4;
}

</style>
<script>

//  Get params

function getAllUrlParams(url) {

  // get query string from url (optional) or window
  var queryString = url ? url.split('?')[1] : window.location.search.slice(1);

  // we'll store the parameters here
  var obj = {};

  // if query string exists
  if (queryString) {

    // stuff after # is not part of query string, so get rid of it
    queryString = queryString.split('#')[0];

    // split our query string into its component parts
    var arr = queryString.split('&');

    for (var i=0; i<arr.length; i++) {
      // separate the keys and the values
      var a = arr[i].split('=');

      // in case params look like: list[]=thing1&list[]=thing2
      var paramNum = undefined;
      var paramName = a[0].replace(/\[\d*\]/, function(v) {
        paramNum = v.slice(1,-1);
        return '';
      });

      // set parameter value (use 'true' if empty)
      var paramValue = typeof(a[1])==='undefined' ? true : a[1];

      // (optional) keep case consistent
      paramName = paramName.toLowerCase();
      paramValue = paramValue.toLowerCase();

      // if parameter name already exists
      if (obj[paramName]) {
        // convert value to array (if still string)
        if (typeof obj[paramName] === 'string') {
          obj[paramName] = [obj[paramName]];
        }
        // if no array index number specified...
        if (typeof paramNum === 'undefined') {
          // put the value on the end of the array
          obj[paramName].push(paramValue);
        }
        // if array index number specified...
        else {
          // put the value at that index number
          obj[paramName][paramNum] = paramValue;
        }
      }
      // if param name doesn't exist yet, set it
      else {
        obj[paramName] = paramValue;
      }
    }
  }

  return obj;
}


var date = getAllUrlParams().date;
var amount = getAllUrlParams().amount;

// api call price for specific date
var url = "https://api.coindesk.com/v1/bpi/historical/close.json?" + "start=" + date + "&end=" + date;

console.log(url);

axios.get(url)
  .then(function (response) {
    var res = response.data.bpi;
    var price = res[Object.keys(res)[0]];
    console.log(price);
  })
  .catch(function (error) {
    console.log(error);
  });

// api call current price
  // axios.get("https://api.coindesk.com/v1/bpi/currentprice.json")
  //   .then(function (response) {
  //     var res = response.data.bpi.USD.rate;
  //     console.log(res);
  //   })
  //   .catch(function (error) {
  //     console.log(error);
  //   });

currentPrice = 2800;

// change ui
  function changeAmount () {
    var amountEl = document.querySelector("#amount");
    amountEl.innerHTML= splitMille(amount);
  }

  function changeDate () {
    var dateEl = document.querySelector("#date");
    dateEl.innerHTML= date;
  }

  function splitMille(n, separator = ',') {
    // Cast to string
    let num = (n + '')

    // Test for and get any decimals (the later operations won't support them)
    let decimals = ''
    if (/\./.test(num)) {
      // This regex grabs the decimal point as well as the decimal numbers
      decimals = num.replace(/^.*(\..*)$/, '$1')
    }

    // Remove decimals from the number string
    num = num.replace(decimals, '')
      // Reverse the number string through Array functions
      .split('').reverse().join('')
      // Split into groups of 1-3 characters (with optional supported character "-" for negative numbers)
      .match(/[0-9]{1,3}-?/g)
      // Add in the mille separator character and reverse back
      .join(separator).split('').reverse().join('')

    // Put the decimals back and output the formatted number
    return `${num}${decimals}`
  }

  function makeMath () {
    axios.get(url)
      .then(function (response) {
        var res = response.data.bpi;
        var price = res[Object.keys(res)[0]];
        var profitEl = document.querySelector("#profit");
        netProfit = Math.round(amount/price*currentPrice-amount);
        profitEl.innerHTML= splitMille(netProfit);

        var percEl = document.querySelector('#percentage');
        percEl.innerHTML = splitMille(Math.round(netProfit/amount*100));
      })
      .catch(function (error) {
        console.log(error);
      });
  }

  window.onload = changeAmount();
  window.onload = changeDate();
  window.onload = makeMath();
// math to calculate profits.

console.log(amount)

</script>
